# 项目后续提升方向（Roadmap）

本文用于记录本项目在 **不改变现有玩法/不重构机器人逻辑** 的前提下，优先级最高的工程化提升方向；在项目稳定后，再逐步推进“公平对战 AI”与整体对战引擎重构。

## 当前状态（已完成/已明确）

- 已迁移到 **Go Modules**（`go.mod`），内部包 import 已改为模块路径。
- 已修复 **跨平台路径问题**（配置/日志/pid 等目录自动创建，避免 macOS 下因 `..\\` 路径导致 panic）。

## 最高优先级：稳定性与可复现（为后续 AI/回归奠基）

- **统一随机性与 seed**
  - 将“洗牌/机器人牌型生成/难度 limit/计分随机项”等随机来源统一到同一个 RNG。
  - 每局记录并展示 seed（日志/输出），支持用 seed 复现。
- **回放/黄金用例（Golden tests）**
  - 固定一批关键局面：七小对/十三幺/一条龙/碰/杠/听牌/加杠等。
  - 对“同 seed + 同输入序列”产生的关键事件/结算做快照对比，锁住现有玩法行为。
- **错误处理收敛**
  - 业务可预期失败（缺文件/目录、归档失败、生成失败）优先返回 error 或降级处理，减少 panic 造成的中断。
  - 仅在“不变量破坏/严重逻辑错误”时 panic，并在顶层统一 recover + 输出可定位信息。

## 可维护性：结构解耦（先不改玩法，先改组织方式）

- **解耦 I/O 与规则推进**
  - 把 `fmt.Printf` / `Scanner` 从核心逻辑中隔离出来（用接口注入 Input/Output）。
  - 引擎层只产生“事件/动作”，CLI 层负责渲染与交互。
- **显式状态机化**
  - 明确回合阶段：发牌/摸牌/判胡/询问/碰杠处理/出牌/结算。
  - 将散落的状态字段（如 `isWaiting/isClear/condition`）整理为更可读的结构或枚举。
- **减少魔法数与集中配置**
  - 统一管理 13/14/25、limit range、概率等常量。
  - 将“挑战式机制”作为显式的 mode/config，便于后续扩展“公平对战”模式而不互相污染。

## 性能：先量化，再优化热点（为批量仿真铺路）

- **Benchmark 建立**
  - 给 `JudgeIsWin`、`CheckIsWaiting` 建立基准测试，避免凭感觉优化。
- **低风险优化**
  - 减少重复排序、减少 slice 拷贝与临时对象分配。
- **结构性优化（稳定后再做）**
  - 将判胡/听牌从“字符串切片 + 排序 + 删除”逐步迁移到“计数数组/位图表示”，显著提升吞吐。

## 可观测性：结构化日志与事件流

- **结构化事件记录**
  - 记录关键事件：摸牌、打牌、碰、杠、听牌声明、判胡结果、结算项、limit 触发等。
  - 建议支持 JSON（便于后续数据分析与 AI 训练/调参）。
- **诊断信息增强**
  - 关键参数打印：seed、limit、模式、版本、回合数、最终牌墙摘要等。

## 工程化与发布（公开仓库的基础建设）

- **README 更清晰的“模式说明”**
  - 说明当前是挑战式玩法（含 turn limit/机器人牌展示等），避免用户误解为公平对战。
- **CI**
  - GitHub Actions：`go test ./...`（后续可加 lint/benchmark）。
- **Release 策略**
  - 是否提供跨平台二进制（macOS/Linux/Windows），以及如何存放配置与日志目录（用户目录 vs 项目目录）。

## “公平对战 AI”前置（先列清单，暂不动现有机器人逻辑）

在不改变当前玩法的前提下，先把 AI 需要的基础能力补齐：

- 可复现（seed + 回放）
- 引擎可被“无交互调用”（可注入输入、可输出事件）
- 性能足够支撑批量自对弈/评估

等上述基础稳定后，再启动：
- 机器人手牌维护与策略系统
- 公平对战规则模式（取消硬判负、对称摸打等）


